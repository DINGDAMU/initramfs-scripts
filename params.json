{"name":"Initramfs-scripts","tagline":"RTOS project","body":"instructions:\r\n\r\n\r\nMake sure the corresponding paths in the shell scripts are right on your computer. \r\nsudo ./mkfs.sh -r [ROOT's directory ]  change the ROOT'S directory\r\nsudo ./mkfs.sh -b [BUSYBOX's directory ]  change the BUSYBOX'S directory\r\nsudo ./mkfs.sh -c [CROSS's directory ]  change the CROSS'S directory\r\nsudo ./mkfs.sh -t [TARGET_LIBS's directory ]  change the TARGET_LIBS'S directory\r\nsudo ./mkfs.sh -d [DEST's directory ]  change the DEST'S directory\r\n\r\n\r\n\r\nyou can use:\r\nsudo ./mkfs.sh -k [module directory] to add the kernel module\r\nsudo ./mkfs.sh -u [user program directory] to add the user program\r\nsudo ./mkfs.sh -b [boot scripts directory] to replace the boot scripts in the system\r\notherwise, nothing will be added.\r\n\r\nThese shell scripts will create a 1.2M-sized image, which can work well in the qemu. In addition, the shell scripts are non-interactive, it means that they    won't ask you to insert anything as the input.\r\n\r\nMotivations about my project:\r\n\r\nBased on the half-working example, there are two main things which I need to do  for \r\nthis project.\r\n\r\n1. The inclusion of custom programs, kernel modules, or boot scripts in the image must be supported.\r\nI used getopts to sparse them, dividing them into several cases. \":\" after the choice(k,u,b) means that it permits you to add some new parameters after the choice.\r\n\r\n2.The size of the initramfs must be reduced to the minimum.  \r\n\r\nThis is the most important project's part.\r\n\r\nAt the beginning, I entered the folder ../rootfs/lib and cancelled all the files\r\n*.o and *.a. Because in terms of executables, they have been compiled by static libraries(or maybe a single object file), object files and static libraries are not needed any more in the image.\r\n\r\nFor instance,I need to know which shared objects are necessary. In the ../rootfs/bin folder, with \"arm-unknown-linux-gnu-readelf -d busybox\", I can easily find that \"libc.so\" ,\"libcrypt.so\"and \"libm.so\" are needed. Moreover, to login the system, I checked every shared objects with \"arm-unknown-linux-gnu-nm\" and found that \"libnss_compat-2.3.2.so\" supports the login.(00002eac t copy_pwd_changes\r\n00005948 t copy_spwd_changes)\r\n\r\nContinuously, I used \"arm-unknown-linux-gnu-readelf -d [ELF file]\" to read the relationships between each shared objects(*.so). \"libcrypt-2.3.2.so\" and \"libm-2.3.2.so\" rely on \"libc-2.3.2.so\", it's OK, but \"libc.so\" relies on \"ld-2.3.2.so\", so this one I shouldn't cancel. For the same reason, \"libnss_compat-2.3.2.so\" depends on \"libnsl-2.3.2.so\" which should also  be kept.\r\n\r\nSo in conclusion, the necessary dynamic libraries are:\r\nlibc-2.3.2.so\r\nlibcrypt-2.3.2.so\r\nlibm-2.3.2.so\r\nld-2.3.2.so\r\nlibnsl-2.3.2.so\r\nlibnss_compat-2.3.2.so\r\n\r\nHowever, it has not been finished yet. After cancelling all the unwanted dynamic libraries, I need to use \"arm-unknown-linux-gnu-strip\" to reduce the size of the needed dynamic libraries. GNU strip discards all symbols from object files objfile. The list of object files may include archives. It can help us to reduce the size of the output image.\r\n\r\nAt last, we can get a 1.2M sized image. In the qemu, it supports the system's login and every shell in the folder bin and sbin. If you want to use the kernel module, sometimes you may need to add and insmod some other kernel modules(ex,xenomai) so that you can run it. But for our case to minimize the image , theyâ€™re not needed because the main advantage of kernel module is that you can add and use it whenever you want.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}